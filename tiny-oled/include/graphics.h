#pragma once

#include <stddef.h>
#include <stdint.h>
#include <avr/pgmspace.h>
#include "util.h"

#define SCREEN_SIZE (8 * 16)
#define SPRITE_BLANK 0
#define SPRITE_A 1
#define SPRITE_0 27
#define SPRITE_EXCLAMATION_MARK 37
#define SPRITE_SEGMENT_HORIZONTAL 38
#define SPRITE_SEGMENT_VERTICAL 39
#define SPRITE_SEGMENT_MIDDLE 41

typedef union {
	struct {
		uint8_t visible : 1, hMirror : 1, vMirror : 1, inverted : 1; // TODO
	};
	uint8_t byte;
} SpriteAttributes;

const uint8_t sprites[][8] PROGMEM = {
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, // space
	{ 0x00, 0x7c, 0x7e, 0x13, 0x13, 0x7e, 0x7c, 0x00 }, // A
	{ 0x00, 0x7f, 0x7f, 0x45, 0x45, 0x7f, 0x36, 0x00 }, // B
	{ 0x00, 0x3e, 0x7f, 0x41, 0x41, 0x63, 0x22, 0x00 }, // C
	{ 0x00, 0x7f, 0x7f, 0x41, 0x41, 0x7f, 0x3e, 0x00 }, // D
	{ 0x00, 0x7f, 0x7f, 0x49, 0x49, 0x41, 0x41, 0x00 }, // E
	{ 0x00, 0x7f, 0x7f, 0x09, 0x09, 0x01, 0x01, 0x00 }, // F
	{ 0x00, 0x3e, 0x7f, 0x41, 0x49, 0x7b, 0x3a, 0x00 }, // G
	{ 0x00, 0x7f, 0x7f, 0x08, 0x08, 0x7f, 0x7f, 0x00 }, // H
	{ 0x00, 0x00, 0x41, 0x7f, 0x7f, 0x41, 0x00, 0x00 }, // I
	{ 0x00, 0x20, 0x60, 0x41, 0x7f, 0x3f, 0x01, 0x00 }, // J
	{ 0x00, 0x7f, 0x7f, 0x08, 0x1c, 0x77, 0x63, 0x00 }, // K
	{ 0x00, 0x7f, 0x7f, 0x40, 0x40, 0x40, 0x40, 0x00 }, // L
	{ 0x00, 0x7f, 0x7f, 0x06, 0x0c, 0x06, 0x7f, 0x7f }, // M
	{ 0x00, 0x7f, 0x7f, 0x0c, 0x18, 0x7f, 0x7f, 0x00 }, // N
	{ 0x00, 0x3e, 0x7f, 0x41, 0x41, 0x7f, 0x3e, 0x00 }, // O
	{ 0x00, 0x7f, 0x7f, 0x09, 0x09, 0x0f, 0x06, 0x00 }, // P
	{ 0x00, 0x1e, 0x3f, 0x21, 0x21, 0x7f, 0x5e, 0x00 }, // Q
	{ 0x00, 0x7f, 0x7f, 0x09, 0x39, 0x6f, 0x46, 0x00 }, // R
	{ 0x00, 0x26, 0x6f, 0x49, 0x49, 0x7b, 0x32, 0x00 }, // S
	{ 0x00, 0x01, 0x01, 0x7f, 0x7f, 0x01, 0x01, 0x00 }, // T
	{ 0x00, 0x3f, 0x7f, 0x40, 0x40, 0x7f, 0x3f, 0x00 }, // U
	{ 0x00, 0x07, 0x1f, 0x70, 0x70, 0x1f, 0x07, 0x00 }, // V
	{ 0x00, 0x1f, 0x7f, 0x70, 0x1c, 0x70, 0x7f, 0x1f }, // W
	{ 0x00, 0x63, 0x77, 0x1c, 0x1c, 0x77, 0x63, 0x00 }, // X
	{ 0x00, 0x07, 0x0f, 0x78, 0x78, 0x0f, 0x07, 0x00 }, // Y
	{ 0x00, 0x61, 0x71, 0x59, 0x4d, 0x47, 0x43, 0x00 }, // Z
	{ 0x00, 0x3e, 0x7f, 0x49, 0x45, 0x7f, 0x3e, 0x00 }, // 0
	{ 0x00, 0x00, 0x42, 0x7f, 0x7f, 0x40, 0x00, 0x00 }, // 1
	{ 0x00, 0x42, 0x63, 0x71, 0x59, 0x4f, 0x46, 0x00 }, // 2
	{ 0x00, 0x22, 0x63, 0x49, 0x49, 0x7f, 0x36, 0x00 }, // 3
	{ 0x00, 0x18, 0x1c, 0x16, 0x73, 0x79, 0x10, 0x00 }, // 4
	{ 0x00, 0x27, 0x67, 0x45, 0x45, 0x7d, 0x39, 0x00 }, // 5
	{ 0x00, 0x3e, 0x7f, 0x49, 0x49, 0x7b, 0x32, 0x00 }, // 6
	{ 0x00, 0x03, 0x03, 0x61, 0x79, 0x1f, 0x07, 0x00 }, // 7
	{ 0x00, 0x36, 0x7f, 0x49, 0x49, 0x7f, 0x36, 0x00 }, // 8
	{ 0x00, 0x26, 0x6f, 0x49, 0x49, 0x7f, 0x3e, 0x00 }, // 9
	{ 0x00, 0x00, 0x00, 0x5f, 0x5f, 0x00, 0x00, 0x00 }, // !
	// 7 segment
	{ 0x60, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0 }, // horizontal left, on bottom
	{ 0xfe, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00 }, // vertical top, on left
	{ 0x3f, 0x7f, 0x7f, 0x7f, 0x00, 0x00, 0x00, 0x00 }, // vertical bottom, on left
	{ 0x80, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0 }, // middle top left
};

const uint8_t digit7Segments[] = {
	0b1111110,
	0b0110000,
	0b1101101,
	0b1111001,
	0b0110011,
	0b1011011,
	0b1011111,
	0b1110000,
	0b1111111,
	0b1111011,
	0b1110111,
	0b0011111,
	0b1001110,
	0b0111101,
	0b1001111,
	0b1000111,
};

void stringToSprites(const char* PROGMEM string, uint8_t* destinaton);

void init7SegmentSprites(uint8_t spriteTable[SCREEN_SIZE], uint8_t attributeTable[SCREEN_SIZE / 2], uint8_t topLeft);
void set7SegmentAttributes(uint8_t attributeTable[SCREEN_SIZE / 2], uint8_t digit, uint8_t topLeft);
